#!/bin/zsh
env_warning = <<EOF
# This file is generated by load-env script. Do not edit it manually.
# To add or change e nvironment variables, edit .env.template or .env.local file,
# and run 'load-env' script to apply changes.
EOF


if [[ "${1:-}" != "--existing" ]] || [[ ! -f ${ZDOTDIR:-~}/.env ]]; then
  cat <(echo $env_warning) <(op inject -f -i ${ZDOTDIR:-~}/.env.template) > ${ZDOTDIR:-~}/.env
fi

setopt allexport
source ${ZDOTDIR:-~}/.env
[[ -f ${ZDOTDIR:-~}/.env.local ]] && source ${ZDOTDIR:-~}/.env.local
unsetopt allexport
